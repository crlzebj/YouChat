<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouChat</title>
</head>
<body>
<ul id="list"></ul>
<input type="text" id="message" placeholder="请输入消息">
<button id="send">发送</button>
<script>
    // 创建一个WebSocket连接
    const socket = new WebSocket('ws://localhost:9090/websocket?token=1736171766aeeb5b16-df93-4afd-99cf-f410b5a44825');

    // 监听连接打开事件
    socket.addEventListener('open', (event) => {
        console.log('WebSocket is open now.');
    });

    // 监听消息事件
    socket.addEventListener('message', (event) => {
        console.log('Message from server: ', event.data);
        var layer=document.createElement("div");
        var txt=document.createTextNode(event.data);
        layer.setAttribute("id","WndName");
        layer.appendChild(txt);
        document.body.appendChild(layer);
    });

    // 监听错误事件
    socket.addEventListener('error', (error) => {
        console.error('WebSocket encountered error: ', error);
    });

    // 监听连接关闭事件
    socket.addEventListener('close', (event) => {
        console.log('WebSocket is closed now.');
    });

    document.getElementById('send').addEventListener('click', () => {
        const message = document.getElementById('message').value;
        if (message && socket.readyState === WebSocket.OPEN) {
            var json = {};
            json.type = 1;
            json.receiverId = 90879658;
            json.data = message;
            socket.send(JSON.stringify(json));
            console.log('Message sent:', message);
        } else if (socket.readyState !== WebSocket.OPEN) {
            console.error('WebSocket is not open.');
        } else {
            console.warn('Message is empty.');
        }
        document.getElementById('message').value = '';
    });
</script>
</body>
</html>
